<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Sistema de cadastro de usu√°rios com valida√ß√£o de CPF e busca de CEP">
    <title>Cadastro de Usu√°rio | Sistema de Gest√£o</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <!-- Skip link para acessibilidade -->
    <a href="#conteudo-principal" class="skip-link">Pular para o conte√∫do principal</a>

    <!-- Cabe√ßalho -->
    <header class="cabecalho" role="banner">
        <div class="container cabecalho-conteudo">
            <a href="index.html" class="logo" aria-label="P√°gina inicial do Sistema de Gest√£o">
                <span class="logo-icone" aria-hidden="true">üë§</span>
                <span>Cadastro de Usu√°rio</span>
            </a>
            <nav class="navegacao" role="navigation" aria-label="Menu principal">
                <a href="index.html" class="nav-link ativo" aria-current="page">
                    <span aria-hidden="true">üìù</span>
                    Cadastro
                </a>
                <a href="lista.html" class="nav-link">
                    <span aria-hidden="true">üìã</span>
                    Lista de Usu√°rios
                </a>
            </nav>
        </div>
    </header>

    <!-- Conte√∫do Principal -->
    <main id="conteudo-principal" class="principal" role="main">
        <div class="container container-sm">
            <h1 class="titulo-pagina">Cadastro de Usu√°rio</h1>
            <p class="subtitulo-pagina">Preencha os dados abaixo para cadastrar um novo usu√°rio no sistema.</p>

            <div class="card">
                <h2 class="card-titulo">Dados Pessoais</h2>

                <form id="form-cadastro" class="formulario" novalidate>
                    <!-- Foto do usu√°rio -->
                    <div class="campo-foto-container">
                        <div class="foto-preview" id="foto-preview" role="img" aria-label="Pr√©via da foto do usu√°rio">
                            <span class="foto-placeholder" aria-hidden="true">üë§</span>
                        </div>
                        <div class="foto-acoes">
                            <label class="campo-label">Foto do Usu√°rio</label>
                            <p class="campo-ajuda">Tire uma foto ou escolha da galeria</p>
                            <div class="foto-botoes">
                                <button type="button" class="btn btn-secundario btn-sm" id="btn-camera" aria-label="Tirar foto com a c√¢mera">
                                    <span aria-hidden="true">üì∑</span>
                                    C√¢mera
                                </button>
                                <button type="button" class="btn btn-secundario btn-sm" id="btn-galeria" aria-label="Escolher foto da galeria">
                                    <span aria-hidden="true">üñºÔ∏è</span>
                                    Galeria
                                </button>
                                <button type="button" class="btn btn-perigo btn-sm" id="btn-remover-foto" style="display: none;" aria-label="Remover foto">
                                    <span aria-hidden="true">üóëÔ∏è</span>
                                </button>
                            </div>
                            <input type="file" id="input-foto-camera" accept="image/*" capture="user" class="input-foto-hidden" aria-hidden="true">
                            <input type="file" id="input-foto-galeria" accept="image/*" class="input-foto-hidden" aria-hidden="true">
                        </div>
                    </div>

                    <!-- Dados pessoais -->
                    <div class="grupo-campos">
                        <div class="campo">
                            <label for="nome" class="campo-label">
                                Nome <span class="campo-obrigatorio" aria-hidden="true">*</span>
                                <span class="sr-only">(obrigat√≥rio)</span>
                            </label>
                            <input
                                type="text"
                                id="nome"
                                name="nome"
                                class="campo-input"
                                placeholder="Digite seu nome"
                                required
                                autocomplete="given-name"
                                aria-describedby="nome-erro"
                            >
                            <span id="nome-erro" class="campo-erro" role="alert" aria-live="polite"></span>
                        </div>

                        <div class="campo">
                            <label for="sobrenome" class="campo-label">
                                Sobrenome <span class="campo-obrigatorio" aria-hidden="true">*</span>
                                <span class="sr-only">(obrigat√≥rio)</span>
                            </label>
                            <input
                                type="text"
                                id="sobrenome"
                                name="sobrenome"
                                class="campo-input"
                                placeholder="Digite seu sobrenome"
                                required
                                autocomplete="family-name"
                                aria-describedby="sobrenome-erro"
                            >
                            <span id="sobrenome-erro" class="campo-erro" role="alert" aria-live="polite"></span>
                        </div>
                    </div>

                    <div class="campo">
                        <label for="cpf" class="campo-label">
                            CPF <span class="campo-obrigatorio" aria-hidden="true">*</span>
                            <span class="sr-only">(obrigat√≥rio)</span>
                            <button type="button" class="btn-ajuda-api" aria-label="Como funciona a valida√ß√£o de CPF" data-tooltip="cpf-tooltip">
                                ‚ùî
                            </button>
                        </label>
                        <div class="tooltip-api" id="cpf-tooltip" role="tooltip" aria-hidden="true">
                            <button type="button" class="tooltip-fechar" aria-label="Fechar">√ó</button>
                            <h4>üîê Valida√ß√£o de CPF - API Invertexto</h4>
                            <div class="tooltip-conteudo">
                                <p><strong>Como funciona:</strong></p>
                                <ol>
                                    <li><strong>Valida√ß√£o Matem√°tica Local:</strong> Primeiro, o sistema verifica se o CPF √© matematicamente v√°lido usando o algoritmo oficial dos d√≠gitos verificadores (m√≥dulo 11).</li>
                                    <li><strong>Verifica√ß√£o de Duplicidade:</strong> O sistema consulta a base de dados local para verificar se o CPF j√° est√° cadastrado.</li>
                                    <li><strong>Valida√ß√£o via API:</strong> Se as valida√ß√µes anteriores passarem, o CPF √© enviado para a API Invertexto que verifica se o documento existe na base da Receita Federal.</li>
                                </ol>
                                <p><strong>Fluxo t√©cnico:</strong></p>
                                <code>GET https://api.invertexto.com/v1/validator?token={token}&value={cpf}&type=cpf</code>
                                <p><strong>Resposta da API:</strong></p>
                                <code>{ "valid": true, "formatted": "123.456.789-00" }</code>
                                <p><strong>Cache:</strong> CPFs validados s√£o armazenados em cache durante a sess√£o para evitar chamadas repetidas.</p>
                                <p><strong>Fallback:</strong> Se a API estiver indispon√≠vel, o sistema aceita a valida√ß√£o matem√°tica local.</p>
                            </div>
                            <a href="https://api.invertexto.com/" target="_blank" rel="noopener noreferrer" class="tooltip-link">
                                üîó Documenta√ß√£o da API Invertexto
                            </a>
                        </div>
                        <input
                            type="text"
                            id="cpf"
                            name="cpf"
                            class="campo-input"
                            placeholder="000.000.000-00"
                            required
                            maxlength="14"
                            inputmode="numeric"
                            aria-describedby="cpf-ajuda cpf-erro"
                        >
                        <span id="cpf-ajuda" class="campo-ajuda">Digite apenas os n√∫meros do CPF</span>
                        <span id="cpf-erro" class="campo-erro" role="alert" aria-live="polite"></span>
                    </div>

                    <div class="campo">
                        <label for="dataNascimento" class="campo-label">
                            Data de Nascimento <span class="campo-obrigatorio" aria-hidden="true">*</span>
                            <span class="sr-only">(obrigat√≥rio)</span>
                        </label>
                        <input
                            type="date"
                            id="dataNascimento"
                            name="dataNascimento"
                            class="campo-input"
                            required
                            aria-describedby="dataNascimento-erro"
                        >
                        <span id="dataNascimento-erro" class="campo-erro" role="alert" aria-live="polite"></span>
                    </div>

                    <!-- Separador de se√ß√£o -->
                    <div class="secao-separador" role="separator">
                        <span>Endere√ßo</span>
                    </div>

                    <!-- Busca por CEP -->
                    <div class="grupo-campos">
                        <div class="campo">
                            <label for="cep" class="campo-label">
                                CEP
                                <button type="button" class="btn-ajuda-api" aria-label="Como funciona a busca de CEP" data-tooltip="cep-tooltip">
                                    ‚ùî
                                </button>
                            </label>
                            <div class="tooltip-api" id="cep-tooltip" role="tooltip" aria-hidden="true">
                                <button type="button" class="tooltip-fechar" aria-label="Fechar">√ó</button>
                                <h4>üìç Busca de Endere√ßo - API ViaCEP</h4>
                                <div class="tooltip-conteudo">
                                    <p><strong>Como funciona:</strong></p>
                                    <ol>
                                        <li><strong>Digita√ß√£o do CEP:</strong> O usu√°rio digita o CEP no formato 00000-000 (a m√°scara √© aplicada automaticamente).</li>
                                        <li><strong>Disparo da Busca:</strong> Quando o campo perde o foco (blur) e o CEP tem 8 d√≠gitos, a busca √© iniciada.</li>
                                        <li><strong>Consulta √† API:</strong> O sistema envia uma requisi√ß√£o GET para a API ViaCEP com o CEP informado.</li>
                                        <li><strong>Preenchimento Autom√°tico:</strong> Se encontrado, os campos Logradouro, Bairro, Cidade e Estado s√£o preenchidos automaticamente.</li>
                                    </ol>
                                    <p><strong>Fluxo t√©cnico:</strong></p>
                                    <code>GET https://viacep.com.br/ws/{cep}/json/</code>
                                    <p><strong>Exemplo de resposta:</strong></p>
                                    <code>{
  "cep": "01310-100",
  "logradouro": "Avenida Paulista",
  "bairro": "Bela Vista",
  "localidade": "S√£o Paulo",
  "uf": "SP"
}</code>
                                    <p><strong>Tratamento de erros:</strong> Se o CEP n√£o for encontrado, o sistema exibe uma mensagem de erro e libera os campos para preenchimento manual.</p>
                                </div>
                                <a href="https://viacep.com.br/" target="_blank" rel="noopener noreferrer" class="tooltip-link">
                                    üîó Documenta√ß√£o da API ViaCEP
                                </a>
                            </div>
                            <div class="campo-com-icone">
                                <input
                                    type="text"
                                    id="cep"
                                    name="cep"
                                    class="campo-input"
                                    placeholder="00000-000"
                                    maxlength="9"
                                    inputmode="numeric"
                                    aria-describedby="cep-ajuda cep-erro"
                                >
                                <span id="cep-icone" class="campo-icone" aria-hidden="true">üîç</span>
                            </div>
                            <span id="cep-ajuda" class="campo-ajuda">Digite o CEP para buscar o endere√ßo automaticamente</span>
                            <span id="cep-erro" class="campo-erro" role="alert" aria-live="polite"></span>
                        </div>
                    </div>

                    <div class="grupo-campos">
                        <div class="campo">
                            <label for="estado" class="campo-label">
                                Estado
                                <button type="button" class="btn-ajuda-api" aria-label="Como funciona a listagem de estados" data-tooltip="estado-tooltip">
                                    ‚ùî
                                </button>
                            </label>
                            <div class="tooltip-api" id="estado-tooltip" role="tooltip" aria-hidden="true">
                                <button type="button" class="tooltip-fechar" aria-label="Fechar">√ó</button>
                                <h4>üó∫Ô∏è Lista de Estados - API IBGE</h4>
                                <div class="tooltip-conteudo">
                                    <p><strong>Como funciona:</strong></p>
                                    <ol>
                                        <li><strong>Carregamento Inicial:</strong> Quando a p√°gina √© carregada, o sistema faz uma requisi√ß√£o √† API do IBGE para obter a lista de todos os estados brasileiros.</li>
                                        <li><strong>Ordena√ß√£o:</strong> Os estados s√£o retornados j√° ordenados alfabeticamente pelo nome.</li>
                                        <li><strong>Cache:</strong> A lista √© armazenada em cache na mem√≥ria para evitar requisi√ß√µes repetidas durante a sess√£o.</li>
                                        <li><strong>Preenchimento do Select:</strong> O dropdown √© populado com os 27 estados (26 + DF), exibindo o nome completo e usando a sigla (UF) como valor.</li>
                                    </ol>
                                    <p><strong>Fluxo t√©cnico:</strong></p>
                                    <code>GET https://servicodados.ibge.gov.br/api/v1/localidades/estados?orderBy=nome</code>
                                    <p><strong>Exemplo de resposta:</strong></p>
                                    <code>[
  { "id": 12, "sigla": "AC", "nome": "Acre" },
  { "id": 27, "sigla": "AL", "nome": "Alagoas" },
  ...
]</code>
                                    <p><strong>Fallback:</strong> Se a API estiver indispon√≠vel, o sistema utiliza uma lista est√°tica de estados pr√©-definida no c√≥digo.</p>
                                </div>
                                <a href="https://servicodados.ibge.gov.br/api/docs/localidades" target="_blank" rel="noopener noreferrer" class="tooltip-link">
                                    üîó Documenta√ß√£o da API IBGE Localidades
                                </a>
                            </div>
                            <select
                                id="estado"
                                name="estado"
                                class="campo-select"
                                aria-describedby="estado-ajuda"
                            >
                                <option value="">Selecione o estado</option>
                            </select>
                            <span id="estado-ajuda" class="campo-ajuda">Selecione para filtrar as cidades</span>
                        </div>

                        <div class="campo">
                            <label for="cidade" class="campo-label">
                                Cidade
                                <button type="button" class="btn-ajuda-api" aria-label="Como funciona a listagem de cidades" data-tooltip="cidade-tooltip">
                                    ‚ùî
                                </button>
                            </label>
                            <div class="tooltip-api" id="cidade-tooltip" role="tooltip" aria-hidden="true">
                                <button type="button" class="tooltip-fechar" aria-label="Fechar">√ó</button>
                                <h4>üèôÔ∏è Lista de Cidades - API IBGE</h4>
                                <div class="tooltip-conteudo">
                                    <p><strong>Como funciona:</strong></p>
                                    <ol>
                                        <li><strong>Sele√ß√£o do Estado:</strong> Quando o usu√°rio seleciona um estado, o sistema dispara uma requisi√ß√£o √† API do IBGE para obter os munic√≠pios daquele estado.</li>
                                        <li><strong>Par√¢metro UF:</strong> A sigla do estado (ex: "SP", "RJ") √© enviada como par√¢metro na URL da requisi√ß√£o.</li>
                                        <li><strong>Ordena√ß√£o:</strong> As cidades s√£o retornadas j√° ordenadas alfabeticamente pelo nome.</li>
                                        <li><strong>Cache por Estado:</strong> As cidades de cada estado s√£o armazenadas em cache separadamente, evitando requisi√ß√µes repetidas.</li>
                                        <li><strong>Atualiza√ß√£o do Select:</strong> O dropdown de cidades √© atualizado com todos os munic√≠pios do estado selecionado.</li>
                                    </ol>
                                    <p><strong>Fluxo t√©cnico:</strong></p>
                                    <code>GET https://servicodados.ibge.gov.br/api/v1/localidades/estados/{UF}/municipios?orderBy=nome</code>
                                    <p><strong>Exemplo de resposta (SP):</strong></p>
                                    <code>[
  { "id": 3550308, "nome": "S√£o Paulo" },
  { "id": 3509502, "nome": "Campinas" },
  ...
]</code>
                                    <p><strong>Fallback:</strong> Se a API falhar, o campo √© convertido para um input de texto livre, permitindo digita√ß√£o manual.</p>
                                </div>
                                <a href="https://servicodados.ibge.gov.br/api/docs/localidades" target="_blank" rel="noopener noreferrer" class="tooltip-link">
                                    üîó Documenta√ß√£o da API IBGE Localidades
                                </a>
                            </div>
                            <select
                                id="cidade"
                                name="cidade"
                                class="campo-select"
                                disabled
                                aria-describedby="cidade-ajuda"
                            >
                                <option value="">Selecione primeiro o estado</option>
                            </select>
                            <span id="cidade-ajuda" class="campo-ajuda" aria-live="polite">Cidades dispon√≠veis ap√≥s selecionar o estado</span>
                        </div>
                    </div>

                    <div class="grupo-campos">
                        <div class="campo">
                            <label for="logradouro" class="campo-label">Logradouro</label>
                            <input
                                type="text"
                                id="logradouro"
                                name="logradouro"
                                class="campo-input"
                                placeholder="Rua, Avenida, etc."
                                autocomplete="street-address"
                            >
                        </div>

                        <div class="campo">
                            <label for="numero" class="campo-label">N√∫mero</label>
                            <input
                                type="text"
                                id="numero"
                                name="numero"
                                class="campo-input"
                                placeholder="N¬∫"
                                inputmode="numeric"
                            >
                        </div>
                    </div>

                    <div class="grupo-campos">
                        <div class="campo">
                            <label for="complemento" class="campo-label">Complemento</label>
                            <input
                                type="text"
                                id="complemento"
                                name="complemento"
                                class="campo-input"
                                placeholder="Apto, Bloco, etc."
                            >
                        </div>

                        <div class="campo">
                            <label for="bairro" class="campo-label">Bairro</label>
                            <input
                                type="text"
                                id="bairro"
                                name="bairro"
                                class="campo-input"
                                placeholder="Bairro"
                            >
                        </div>
                    </div>

                    <!-- Bot√µes de a√ß√£o -->
                    <div class="grupo-botoes">
                        <button type="button" id="btn-limpar" class="btn btn-secundario">
                            <span aria-hidden="true">üóëÔ∏è</span>
                            Limpar Formul√°rio
                        </button>
                        <button type="submit" id="btn-cadastrar" class="btn btn-primario btn-lg">
                            <span aria-hidden="true">‚úì</span>
                            Cadastrar Usu√°rio
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </main>

    <!-- Rodap√© -->
    <footer class="rodape" role="contentinfo">
        <div class="container rodape-conteudo">
            <p>&copy; 2025 Sistema de Gest√£o de Usu√°rios. Todos os direitos reservados.</p>
            <p>Desenvolvido por Tharlis David.</p>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="js/utils.js"></script>
    <script src="js/cadastro.js"></script>
</body>
</html>
